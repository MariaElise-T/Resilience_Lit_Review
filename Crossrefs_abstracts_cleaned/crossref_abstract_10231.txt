 We propose a simulation-free framework for stress testing the resilience of a financial network to external shocks affecting balance sheets. Whereas previous studies of contagion effects in financial networks have relied on large scale simulations, our approach uses a simple analytical criterion for resilience to contagion, based on an asymptotic analysis of default cascades in heterogeneous networks. In particular, our methodology does not require to observe the whole network but focuses on the characteristics of the network which contribute to its resilience. Applying this framework to a sample network, we observe that the size of the default cascade generated by a macroeconomic shock across balance sheets may exhibit a sharp transition when the magnitude of the shock reaches a certain threshold: Beyond this threshold, contagion spreads to a large fraction of the financial system. An upper bound is given for the threshold in terms of the characteristics of the network. 