To improve the utilization of flexible resources in microgrids and meet the energy storage requirements of the microgrids in different scenarios, a centralized shared energy storage capacity optimization configuration model for microgrids based on bi-level optimization is proposed. First, the response characteristics of the shared energy storage and controllable load in the resilience microgrid are analyzed, and the centralized shared energy storage operation mode meeting the regulatory demand of multi-scenarios is designed. Then, a bi-level optimal allocation model is constructed, which takes the maximum net income of centralized shared energy storage as the upper layer and the minimum payment cost of load in the microgrid as the lower layer. Furthermore, the multi-objective whale optimization algorithm is used to solve the bi-level optimization model. The results show that the shared energy storage can jointly meet the regulation demand of multi-scenarios by coordinating the transferable load and cuttable load in the microgrid and improving the utilization rate of shared energy storage.