With the increasing severity of global warming and the rapid evolution of cyber-attack techniques, the enhancement of distribution network (DN) resilience that can effectively cope with natural disasters and man-made attacks has received extensive attention. Hence, in the context of a high impact low probability (HILP) event where attackers launch malicious attacks after a natural disaster occurs, a multi-stage DN operation strategy for resilience enhancement is proposed considering multi-type resources, such as gas turbines, stationary energy storage systems, mobile energy storage systems (MESSs), repair crews (RCs) and network reconfiguration. Firstly, the operation process of DN is divided into five stages based on the time lag between the natural disaster and the man-made attacks: the normal operation stage, the disaster disruption stage, the post-disaster degradation stage, the man-made attack stage and the defense and recovery stage. Secondly, under the background of a coupled power-transportation system, the optimal scheduling model for each stage of DN is established considering the effects of dynamic changes in traffic flow on the movement process of MESSs and RCs. Finally, the model is converted into a 5-layer mixed integer linear programming (MILP) problem that can be solved by sophisticated optimization software according to the time series relationship, and a case study is carried out with a modified IEEE 33-node system and the corresponding transportation network. The results demonstrate that under extreme scenarios, the proposed model can guarantee the load-side power supply as much as possible through flexible cooperation between multi-type resources, effectively enhancing the resilience of the DN.