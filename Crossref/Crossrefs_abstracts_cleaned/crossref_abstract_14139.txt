 As the frequency and duration of grid outages increase, backup power systems are becoming more important for ensuring that critical infrastructure continues to provide essential services. Most facilities rely on diesel generators, which may be ineffective during long outages owing to limited fuel supplies and high generator failure rates. Distributed energy resources such as solar, storage, and combined-heat-and-power systems, coupled with on-site biofuel production, offer an alternative source of on-site generation that can provide both cost savings and resilience (i.e., the ability to respond to catastrophic events with longer-term consequences). A mixed-integer linear program minimizes costs and maximizes resilience at a wastewater treatment plant in Wilmington, North Carolina. We find that the plant can reduce life-cycle energy costs by 3.1% through the installation of a hybrid combined-heat-and-power, photovoltaic, and storage system. When paired with existing diesel generators, this system can sustain full load for seven days while saving $664,000 over 25 years and reducing diesel fuel use by 48% compared with the diesel-only solution. This analysis informed a decision by the Cape Fear Public Utility Authority to allocate funds for the implementation of a combined-heat-and-power system at the wastewater treatment plant in fiscal year 2023. The benefits of deploying hybrid combined-heat-and-power technologies and the utilization of on-site biofuel production extend, on a national scale, to thousands of wastewater treatment facilities and other types of critical infrastructure.  Funding: This work was supported by the U.S. Department of Energy, Advanced Manufacturing Office [Grant DE-AC36-08GO28308]. 